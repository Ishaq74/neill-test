---
// Composant Astro natif pour affichage et gestion CRUD des avis
const fetchAvis = async () => {
  const res = await fetch('/api/avis');
  if (!res.ok) return [];
  return await res.json();
};
const avis = await fetchAvis();
---
<section>
  <h2>Liste des avis</h2>
  <table style="width:100%;background:#fff;border-radius:8px;box-shadow:0 2px 8px #0001;">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Commentaire</th>
        <th>Note</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {avis.length === 0 ? (
        <tr><td colspan="4">Aucun avis enregistré.</td></tr>
      ) : (
        avis.map((a: { id: number; nom: string; commentaire: string; note: number }) => (
          <tr>
            <td>{a.nom}</td>
            <td>{a.commentaire}</td>
            <td>{a.note}</td>
            <td>
              <button onclick={`editAvis('${a.id}')`}>Éditer</button>
              <button onclick={`deleteAvis('${a.id}')`}>Supprimer</button>
            </td>
          </tr>
        ))
      )}
    </tbody>
  </table>
</section>
<script type="module">
  async function deleteAvis(id) {
    if (!confirm('Supprimer cet avis ?')) return;
    const res = await fetch('/api/avis', {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id })
    });
    if (res.ok) location.reload();
    else alert('Erreur lors de la suppression');
  }
  function editAvis(id) {
    // À compléter : ouvrir le formulaire d’édition
    alert('Édition non implémentée (démo)');
  }
</script>
