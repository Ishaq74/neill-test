---
import Alert from './starwind/alert/Alert.astro';
let avis = [];
let loading = true;
try {
  // On récupère tous les avis liés à une formation (formationsGlobal=1 ou formationId non nul)
  const res = await fetch('/api/avis-db?formationsGlobal=1');
  if (res.ok) {
    avis = await res.json();
  }
} catch {}
loading = false;
---
{!loading && avis.length > 0 ? (
  <div class="w-full overflow-x-auto py-2">
    <div class="flex gap-4 min-w-full">
      {avis.map((a: { utilisateur?: string; nom?: string; commentaire: string; note: number }) => (
        <div class="bg-white rounded-xl shadow p-6 min-w-[320px] max-w-xs flex-shrink-0">
          <div class="font-semibold text-pink-700 mb-1">{a.utilisateur || a.nom}</div>
          <div class="text-sm text-gray-600 mb-2">{a.commentaire}</div>
          <div class="text-xs text-yellow-600">{a.note} / 5</div>
        </div>
      ))}
    </div>
  </div>
) : (!loading && avis.length === 0) ? (
  <Alert variant="info">Aucun avis à afficher pour le moment.</Alert>
) : null}
