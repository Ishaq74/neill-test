---

import Layout from '@layouts/Layout.astro';
import FormationAvisSummary from '../../components/FormationAvisSummary.astro';
import FormationsAvisCarousel from '../../components/FormationsAvisCarousel.astro';
import FormationsGalleryCarousel from '../../components/FormationsGalleryCarousel.astro';
import FormationsFaqList from '../../components/FormationsFaqList.astro';
import Button from '../../components/starwind/button/Button.astro';
import db from '@lib/db';
import type { Formation } from '../../types/Formation';
let formations: Formation[] = [];
try {
  formations = db.prepare('SELECT * FROM formations ORDER BY id ASC').all() as Formation[];
} catch (e) {
  formations = [];
}
---

<Layout>
  {/* Hero section */}
  <section class="relative bg-gradient-to-br from-pink-100 to-pink-300 py-16 mb-12">
    <div class="container mx-auto flex flex-col md:flex-row items-center gap-10">
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-5xl font-extrabold text-pink-700 mb-4">Formations maquillage à Annecy</h1>
        <p class="text-lg text-gray-700 mb-6 max-w-xl">Développez vos compétences ou découvrez l’art du maquillage avec des formations professionnelles, ludiques et adaptées à tous les niveaux. Inscrivez-vous ou demandez un devis personnalisé !</p>
        <Button href="/contact" variant="primary" size="lg">Demander un devis</Button>
      </div>
      <div class="flex-1 flex justify-center">
        <img src="/assets/cours.jpg" alt="Formation maquillage Annecy" class="rounded-3xl shadow-2xl w-96 h-72 object-cover border-4 border-pink-200" loading="lazy" />
      </div>
    </div>
  </section>

  {/* Liste des formations */}
  <section class="container mx-auto py-8">
    <h2 class="text-3xl font-bold mb-8 text-pink-700 text-center">Nos Formations</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      {formations.length === 0 ? (
        <div class="bg-yellow-100 text-yellow-800 p-4 rounded col-span-3">Aucune formation trouvée.</div>
      ) : (
        formations.map((formation: any) => (
          <div class="bg-white rounded shadow p-6 flex flex-col">
            {formation.image ? (
              <img src={formation.image} alt={formation.titre} class="w-full h-40 object-cover rounded mb-4" loading="lazy" />
            ) : null}
            <h2 class="text-xl font-bold mb-2 text-pink-700">{formation.titre}</h2>
            <div class="mb-2 text-gray-600">{formation.duree ? `Durée : ${formation.duree}` : ''} {formation.niveau ? `| Niveau : ${formation.niveau}` : ''}</div>
            <p class="mb-2 text-gray-700 line-clamp-3">{formation.description || ''}</p>
            <div class="font-bold text-pink-700 text-lg mb-4">{formation.prix} €</div>
            <FormationAvisSummary formationId={formation.id} />
            <a href={`/formations/${formation.slug}`} class="bg-pink-700 text-white px-4 py-2 rounded hover:bg-pink-800 text-center mt-auto block mt-4">Voir la formation</a>
          </div>
        ))
      )}
    </div>
  </section>

  {/* Section Avis sur nos formations (carousel global) */}
  <section class="container mx-auto py-12">
    <h2 class="text-2xl font-bold mb-6 text-pink-700 text-center">Avis sur nos formations</h2>
    <FormationsAvisCarousel />
  </section>

  {/* Section Galerie des formations (carousel global) */}
  <section class="container mx-auto py-12">
    <h2 class="text-2xl font-bold mb-6 text-pink-700 text-center">Galerie des formations</h2>
    <FormationsGalleryCarousel />
  </section>

  {/* Section FAQ Formations (liste globale) */}
  <section class="container mx-auto py-12">
    <h2 class="text-2xl font-bold mb-6 text-pink-700 text-center">Questions fréquentes sur les formations</h2>
    <FormationsFaqList />
  </section>

  {/* CTA final */}
  <section class="container mx-auto py-12 flex flex-col items-center">
    <div class="bg-pink-100 rounded-2xl shadow-lg p-10 flex flex-col items-center max-w-2xl">
      <h3 class="text-2xl font-bold text-pink-700 mb-4 text-center">Prêt·e à vous former au maquillage ?</h3>
      <p class="text-gray-700 mb-6 text-center">Contactez-moi pour un devis personnalisé ou inscrivez-vous à la formation de votre choix à Annecy.</p>
      <Button href="/contact" variant="primary" size="lg">Contact</Button>
    </div>
  </section>
</Layout>
