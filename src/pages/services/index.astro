---
import Layout from '@layouts/Layout.astro';
import Card from '../../components/starwind/card/Card.astro';
import CardContent from '../../components/starwind/card/CardContent.astro';
import CardTitle from '../../components/starwind/card/CardTitle.astro';
import Badge from '../../components/starwind/badge/Badge.astro';
import Button from '../../components/starwind/button/Button.astro';
import ServiceAvisSummary from '../../components/ServiceAvisSummary.astro';
import ServicesAvisCarousel from '../../components/ServicesAvisCarousel.astro';
import ServicesGalleryCarousel from '../../components/ServicesGalleryCarousel.astro';
import ServicesFaqList from '../../components/ServicesFaqList.astro';

import db from '@lib/db';
import type { Service } from '../../types/Service';
let services: Service[] = [];
try {
  services = db.prepare('SELECT * FROM services ORDER BY id ASC').all() as Service[];
} catch (e) {
  services = [];
}

// Récupérer toutes les FAQ, avis, images globales pour les services
let allServiceFaqs: any[] = [];
let allServiceAvis: any[] = [];
let allServiceImages: any[] = [];
try {
  allServiceFaqs = db.prepare('SELECT * FROM faq WHERE servicesGlobal = 1 ORDER BY id ASC').all();
  allServiceAvis = db.prepare('SELECT * FROM avis WHERE servicesGlobal = 1 ORDER BY id ASC').all();
  allServiceImages = db.prepare('SELECT * FROM galerie WHERE servicesGlobal = 1 ORDER BY id ASC').all();
} catch {}
---
<Layout>
  {/* Hero section */}
  <section class="relative bg-gradient-to-br from-pink-100 to-pink-300 py-16 mb-12">
    <div class="container mx-auto flex flex-col md:flex-row items-center gap-10">
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-5xl font-extrabold text-pink-700 mb-4">Découvrez nos services de maquillage à Annecy</h1>
        <p class="text-lg text-gray-700 mb-6 max-w-xl">Maquillage professionnel, artistique, événementiel ou formation : sublimez chaque moment avec l’expertise d’une maquilleuse passionnée. Réservez votre séance ou demandez un devis personnalisé !</p>
        <Button href="/contact" variant="primary" size="lg">Demander un devis</Button>
      </div>
      <div class="flex-1 flex justify-center">
        <img src="/assets/mariee-annecy.jpg" alt="Maquillage professionnel Annecy à Annecy" class="rounded-3xl shadow-2xl w-96 h-72 object-cover border-4 border-pink-200" loading="lazy" />
      </div>
    </div>
  </section>

  {/* Liste des services */}
  <section class="container mx-auto py-8">
    <h2 class="text-3xl font-bold mb-8 text-pink-700 text-center">Nos Services</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      {services.map((service: any) => (
        <Card class="flex flex-col h-full">
          {service.image ? (
            <img src={service.image} alt={service.nom} class="w-full h-48 object-cover rounded-t-2xl" loading="lazy" />
          ) : (
            <div class="h-48 flex items-center justify-center bg-gray-100 rounded-t-2xl text-gray-400">Aucune image</div>
          )}
          <CardContent class="flex-1 flex flex-col justify-between">
            <div>
              <CardTitle class="mb-2">{service.nom}</CardTitle>
              <div class="flex gap-2 mb-2">
                {service.categorie && <Badge variant="primary">{service.categorie}</Badge>}
                {service.duree && <Badge variant="secondary">{service.duree}</Badge>}
              </div>
              <p class="mb-3 text-gray-700 line-clamp-3">{service.description}</p>
            </div>
            <div class="flex items-center justify-between mt-4">
              <span class="font-bold text-pink-700 text-xl">{service.prix} €</span>
              <Button href={`/services/${service.slug}`} variant="primary">Voir le service</Button>
            </div>
          </CardContent>
          {/* Section avis résumé */}
          <div class="px-8 pb-4">
            <ServiceAvisSummary serviceId={service.id} />
          </div>
        </Card>
      ))}
    </div>
  </section>

  {/* Section Avis sur nos services (carousel global) */}

  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Avis sur nos services</h2>
    <ServicesAvisCarousel avis={allServiceAvis} />
  </section>

  {/* Section Galerie des services (carousel global) */}
  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Galerie des services</h2>
    <ServicesGalleryCarousel images={allServiceImages} />
  </section>

  {/* Section FAQ services (liste globale) */}
  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Questions fréquentes sur les services</h2>
    <ServicesFaqList faqs={allServiceFaqs} />
  </section>

  {/* CTA final */}
  <section class="container mx-auto py-12 flex flex-col items-center">
    <div class="bg-pink-100 rounded-2xl shadow-lg p-10 flex flex-col items-center max-w-2xl">
      <h3 class="text-2xl font-bold text-pink-700 mb-4 text-center">Prête à sublimer votre beauté ?</h3>
      <p class="text-gray-700 mb-6 text-center">Contactez-moi pour un devis personnalisé ou réservez directement votre séance de maquillage à Annecy.</p>
      <div class="flex gap-4">
        <Button href="/contact" variant="primary" size="lg">Contact</Button>
        <Button href="/reservations" variant="secondary" size="lg">Réserver</Button>
      </div>
    </div>
  </section>
</Layout>